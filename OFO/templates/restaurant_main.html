<head>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/restaurant.css') }}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"/>
</head>
{% extends 'layout/base.html' %}

{% block content %}
<style>
    .restaurant-info-block .restaurant-management-nav {
    width: 100%;
    padding-bottom: 1rem;
    margin-top: 1.5rem;
    margin-bottom: 2rem;
    text-align: left;
}

/* Selector n√†y c·ª• th·ªÉ h∆°n, s·∫Ω ghi ƒë√® l√™n style m·∫∑c ƒë·ªãnh */
.restaurant-info-block .restaurant-management-nav ul {
    display: inline-flex !important; /* D√πng !important ƒë·ªÉ ƒë·∫£m b·∫£o chi·∫øn th·∫Øng */
    align-items: center;
    list-style: none !important; /* Quan tr·ªçng: X√≥a d·∫•u ch·∫•m tr√≤n */
    padding: 0;
    margin: 0;
    gap: 1.5rem;
}

/* Selector n√†y c·ª• th·ªÉ h∆°n, s·∫Ω ghi ƒë√® l√™n style m·∫∑c ƒë·ªãnh */
.restaurant-info-block .restaurant-management-nav li {
    display: block !important; /* B·ªè qua 'display: list-item' m·∫∑c ƒë·ªãnh */
    padding-left: 1.5rem;
    border-left: 1px solid #ced4da; /* T·∫°o d·∫•u g·∫°ch ƒë·ª©ng */
}

/* M·ª•c ƒë·∫ßu ti√™n kh√¥ng c·∫ßn d·∫•u g·∫°ch ƒë·ª©ng b√™n tr√°i */
.restaurant-info-block .restaurant-management-nav li:first-child {
    border-left: none;
    padding-left: 0;
}

.restaurant-info-block .restaurant-management-nav a {
    display: flex;
    align-items: center;
    text-decoration: none;
    color: #495057;
    font-weight: 500;
    font-size: 1.1rem;
    transition: color 0.2s ease-in-out;
}

.restaurant-info-block .restaurant-management-nav a:hover,
.restaurant-info-block .restaurant-management-nav a.active {
    color: #E91E63; /* M√†u xanh n·ªïi b·∫≠t */
    font-weight: 700;
}

.restaurant-info-block .restaurant-management-nav a i {
    margin-right: 8px;
    font-size
}
#dynamicFormOffcanvas {
    --bs-offcanvas-width: 500px;
}
#dynamicFormOffcanvas .offcanvas-header {
    background-color: #FFF0F5;
    border-bottom: 2px solid #E91E63;
}
#dynamicFormOffcanvas .offcanvas-title {
    font-weight: 600;
    color: #E91E63;
}
#dynamicFormOffcanvas .offcanvas-body {
    background-color: #fff;
    padding: 1.5rem;
}

/* --- 2. Thi·∫øt k·∫ø cho c√°c KH·ªêI (section) trong form --- */
.form-section {
    background-color: #FFF0F5;  /* << N·ªÅn h·ªìng r·∫•t nh·∫°t >> */
    border: 1px solid #F8BBD0;
    border-radius: 0.75rem;
    padding: 1.25rem;
    margin-bottom: 1.5rem;
}
.form-section-title {
    font-weight: 600;
    color: #c2185b; /* M√†u h·ªìng t·ªëi h∆°n ƒë·ªÉ d·ªÖ ƒë·ªçc */
    margin-bottom: 1rem;
    padding-bottom: 0.5rem;
    border-bottom: 1px solid #F8BBD0;
}

/* --- 3. T√πy ch·ªânh c√°c √¥ input v√† label --- */
.form-label {
    font-size: 0.9rem;
    font-weight: 500;
    color: #495057;
}
.form-control:focus {
    border-color: #E91E63;
    box-shadow: 0 0 0 0.25rem rgba(233, 30, 99, 0.25); /* << ƒê·ªï b√≥ng h·ªìng khi focus >> */
}

/* --- 4. T√πy ch·ªânh cho n√∫t g·∫°t "B·∫Øt bu·ªôc" --- */
.form-switch {
    display: flex;
    justify-content: space-between; /* ƒê·∫©y label v√† n√∫t g·∫°t ra hai b√™n */
    align-items: center;
    padding-left: 0 !important; /* Ghi ƒë√® padding m·∫∑c ƒë·ªãnh c·ªßa Bootstrap */
}
.form-switch .form-check-label {
    font-size: 0.9rem;
    font-weight: 500;
    color: #495057;
}
.form-switch .form-check-input {
    width: 3.25em;
    height: 1.6em;
    cursor: pointer;
    margin-left: 1em;
}
/* N√∫t g·∫°t s·∫Ω c√≥ m√†u h·ªìng khi ƒë∆∞·ª£c b·∫≠t */
.form-switch .form-check-input:checked {
    background-color: #E91E63;
    border-color: #E91E63;
}


/* --- 5. C√°c th·∫ª l·ª±a ch·ªçn ƒë·ªông --- */
.option-card { /* ƒê√¢y l√† t√™n class m·ªõi cho c√°c th·∫ª l·ª±a ch·ªçn */
    background-color: #fff; /* N·ªÅn tr·∫Øng ƒë·ªÉ n·ªïi b·∫≠t tr√™n n·ªÅn h·ªìng c·ªßa section */
    border: 1px solid #dee2e6;
    border-radius: 0.5rem;
    padding: 1rem;
    margin-bottom: 1rem;
    position: relative;
    transition: all 0.2s ease-in-out;
}
.option-card:hover {
    border-color: #E91E63;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
}
.btn-delete-option {
    position: absolute;
    top: 0.5rem; right: 0.5rem; width: 28px; height: 28px;
    border-radius: 50%; border: none; background-color: #e9ecef; color: #6c757d;
    display: flex; align-items: center; justify-content: center;
    transition: all 0.2s ease;
}
.btn-delete-option:hover {
    background-color: #E91E63; color: white; transform: scale(1.1);
}
.option-card .form-label {
    font-size: 0.85rem; margin-bottom: 0.25rem;
}


/* --- 6. N√∫t "Th√™m L·ª±a Ch·ªçn" v√† "L∆∞u" --- */
#addInputButton {
    border: 2px dashed #E91E63;
    color: #E91E63;
    background-color: transparent; /* N·ªÅn trong su·ªët tr√™n n·ªÅn h·ªìng c·ªßa section */
    font-weight: 500;
    transition: all 0.2s ease;
}
#addInputButton:hover {
    background-color: #E91E63;
    color: white;
    border-style: solid;
}

#dynamicFormOffcanvas .offcanvas-footer {
    padding: 1rem 1.5rem;
    background-color: #fff;
    border-top: 1px solid #e9ecef;
}
#dynamicFormOffcanvas .btn-success {
    background: #E91E63;
    border-color: #E91E63;
    font-weight: 600;
    padding: 0.75rem;
    transition: all 0.2s ease-in-out;
}
#dynamicFormOffcanvas .btn-success:hover {
    opacity: 0.9;
    transform: translateY(-2px);
    box-shadow: 0 4px 15px rgba(233, 30, 99, 0.4);
}
#editOptionGroupOffcanvas {
    --bs-offcanvas-width: 500px;
}
#editOptionGroupOffcanvas .offcanvas-header {
    background-color: #e7f1ff; /* N·ªÅn xanh d∆∞∆°ng r·∫•t nh·∫°t */
    border-bottom: 2px solid #E91E63; /* ƒê∆∞·ªùng vi·ªÅn xanh d∆∞∆°ng ƒë·∫≠m */
}
#editOptionGroupOffcanvas .offcanvas-title {
    font-weight: 600;
    color: #E91E63; /* Ch·ªØ m√†u xanh d∆∞∆°ng ƒë·∫≠m */
}
#editOptionGroupOffcanvas .offcanvas-body {
    background-color: #fff;
    padding: 1.5rem;
}

/* --- 2. Style cho input v√† label (K·∫ø th·ª´a t·ª´ c√°c class chung) --- */
/* C√°c class nh∆∞ .form-label, .form-control s·∫Ω t·ª± ƒë·ªông ƒë∆∞·ª£c √°p d·ª•ng,
   nh∆∞ng ch√∫ng ta s·∫Ω t√πy ch·ªânh hi·ªáu ·ª©ng :focus cho ph√π h·ª£p v·ªõi t√¥ng m√†u xanh */
#editOptionGroupOffcanvas .form-control:focus {
    border-color: #E91E63;
    box-shadow: 0 0 0 0.25rem rgba(13, 110, 253, 0.25); /* ƒê·ªï b√≥ng xanh khi focus */
}

/* --- 3. Style cho n√∫t g·∫°t "B·∫Øt bu·ªôc" --- */
/* Class .form-switch s·∫Ω ƒë∆∞·ª£c √°p d·ª•ng, ch·ªâ c·∫ßn ƒë·ªïi m√†u khi ƒë∆∞·ª£c b·∫≠t */
#editOptionGroupOffcanvas .form-switch .form-check-input:checked {
    background-color: #E91E63;
    border-color: #E91E63;
}

/* --- 4. Style cho c√°c th·∫ª l·ª±a ch·ªçn ƒë·ªông --- */
/* Class chung .option-card s·∫Ω ƒë∆∞·ª£c √°p d·ª•ng, ch·ªâ c·∫ßn t√πy ch·ªânh m√†u khi hover */
#editOptionGroupOffcanvas .option-card:hover {
    border-color: #E91E63; /* Vi·ªÅn xanh khi hover */
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
}
/* N√∫t x√≥a v·∫´n n√™n c√≥ m√†u ƒë·ªè/h·ªìng ƒë·ªÉ c·∫£nh b√°o, n√™n ta gi·ªØ nguy√™n style c≈© cho n√≥ */
#editOptionGroupOffcanvas .btn-delete-option:hover {
    background-color: #dc3545; /* M√†u ƒë·ªè nguy hi·ªÉm */
    color: white;
    transform: scale(1.1);
}
.btn-pink {
    background-color: #E91E63;
    border-color: #E91E63;
    color: white; /* ƒê·ª´ng qu√™n ƒë·ªïi m√†u ch·ªØ cho d·ªÖ ƒë·ªçc */
}
/* --- 5. Style cho c√°c n√∫t h√†nh ƒë·ªông --- */

/* N√∫t "Th√™m L·ª±a Ch·ªçn Kh√°c" */
#addAnotherOptionBtn {
    border: 2px dashed #E91E63;
    color: #E91E63;
    background-color: transparent;
    font-weight: 500;
    transition: all 0.2s ease;
}
#addAnotherOptionBtn:hover {
    background-color: #E91E63;
    color: white;
    border-style: solid;
}

</style >


<div class="container py-4">

    <div class="restaurant-info-block">
        <div class="restaurant-management-nav">
    <ul>
        <li>
            <!-- Trang 'Th·ª±c ƒë∆°n' ƒëang active -->
            <a href="{{ url_for('home', restaurant_id=restaurant.id) }}" class="active">
                <i class="fas fa-utensils"></i>
                <span>Th·ª±c ƒê∆°n</span>
            </a>
        </li>
        <li>
            <a href="#"> <!-- Thay b·∫±ng url_for('...') c·ªßa b·∫°n -->
                <i class="fas fa-receipt"></i>
                <span>ƒê∆°n H√†ng</span>
            </a>
        </li>
        <li>
            <a href="#"> <!-- Thay b·∫±ng url_for('...') c·ªßa b·∫°n -->
                <i class="fas fa-chart-line"></i>
                <span>Doanh Thu</span>
            </a>
        </li>
        <li>
            <a href="#"> <!-- Thay b·∫±ng url_for('...') c·ªßa b·∫°n -->
                <i class="fas fa-tags"></i>
                <span>Khuy·∫øn M√£i</span>
            </a>
        </li>
    </ul>
</div>

        <h1 class="restaurant-title mt-2">{{ restaurant.restaurant_name }}</h1>
        <p class="text-muted fs-5">Tr√† s·ªØa</p>

        <div class="restaurant-meta-group mt-3">
            <div class="restaurant-meta-item">
                <i class="bi bi-star-fill text-warning"></i>
                <span>4.4</span>
            </div>
            <div class="restaurant-meta-item">
                <i class="bi bi-clock"></i>
                <span>60 ph√∫t</span>
            </div>
            <div class="restaurant-meta-item">
                <i class="bi bi-dot"></i>
                <span>1.155,7 km</span>
            </div>
        </div>

        <div class="restaurant-meta-item mt-3 text-muted">
            <span>Gi·ªù m·ªü c·ª≠a</span>
            <strong class="text-dark ms-2">H√¥m nay {{ restaurant.open_time.strftime('%H:%M') }} - {{ restaurant.close_time.strftime('%H:%M') }}</strong>
        </div>

        <div class="promo-section restaurant-meta-item mt-3">
            <i class="bi bi-tag-fill"></i>
            <span>T·∫≠n h∆∞·ªüng ∆∞u ƒë√£i</span>
            <a href="#" class="ms-2">Xem chi ti·∫øt</a>
        </div>
    </div>
    <div class="category-navbar-wrapper mt-4">
        <div class="category-navbar">

            <!-- N√∫t cu·ªôn tr√°i -->
            <button id="scroll-left-btn" class="scroll-btn left d-none">
                <i class="bi bi-chevron-left"></i>
            </button>

            <!-- Danh s√°ch c√°c danh m·ª•c -->
            <div id="category-nav-list" class="category-nav-list">
                <button id="btn_open_modal_dishgroup" class="btn-add-to-dish_group" title="Th√™m nh√≥m m√≥n">+</button>
                {% for group in dish_groups %}
                <a href="#section-{{ group.name | lower | replace(' ', '-') }}" class="category-nav-item">
                    {{ group.name }}
                </a>
                {% endfor %}
            </div>
            <!-- N√∫t cu·ªôn ph·∫£i -->
            <button id="scroll-right-btn" class="scroll-btn right">
                <i class="bi bi-chevron-right"></i>
            </button>

        </div>

    </div>
    <div class="category-navbar-wrapper mt-3">
    <div class="category-navbar">

        <!-- N√∫t cu·ªôn tr√°i (ID m·ªõi) -->
        <button id="scroll-left-btnn" class="scroll-btn left d-none">
                <i class="bi bi-chevron-left"></i>
            </button>

        <!-- Danh s√°ch c√°c Dish_option_Group (ID m·ªõi) -->
        <div id="option-group-nav-list" class="category-nav-list">
            <button class="btn-add-to-dish_group" title="T·∫°o Nh√≥m T√πy Ch·ªçn M·ªõi"
            type="button"
            data-bs-toggle="offcanvas"
            data-bs-target="#dynamicFormOffcanvas">
        +
    </button>

            {# V√≤ng l·∫∑p n√†y s·∫Ω hi·ªÉn th·ªã t·∫•t c·∫£ c√°c nh√≥m t√πy ch·ªçn b·∫°n ƒë√£ t·∫°o #}
            {# Gi·∫£ s·ª≠ b·∫°n truy·ªÅn m·ªôt bi·∫øn `option_groups` t·ª´ backend #}
            {% for option_group in dish_option_group %}
            <a href="#" class="category-nav-item edit-option-group-trigger"
                role="button"
       data-bs-toggle="offcanvas"
       data-bs-target="#editOptionGroupOffcanvas"
               data-group-id="{{ option_group.id }}" >
                {{ option_group.name }}
            </a>
            {% endfor %}
        </div>

        <!-- N√∫t cu·ªôn ph·∫£i (ID m·ªõi) -->
        <button id="scroll-right-btnn" class="scroll-btn right">
            <i class="bi bi-chevron-right"></i>
        </button>

    </div>
</div>

    <!-- ==== B·∫ÆT ƒê·∫¶U PH·∫¶N HI·ªÇN TH·ªä S·∫¢N PH·∫®M ==== -->
    {% for group in dish_groups %}
    <div id="section-{{ group.name | lower | replace(' ', '-') }}" class="menu-section">
        <h2 class="menu-section-title">{{ group.name }}
            <button class="btn-delete-group" title="Xo√° nh√≥m m√≥n" data-id="{{ group.id }}">
                <i class="fas fa-minus"></i>

            </button>
        </h2>
        <!-- N√∫t Xo√° -->


        <div class="row g-4">
            {% for dish in group.dishes %}
            <div class="col-lg-4 col-md-6 d-flex">
                <div class="product-card w-100">
                    <button class="btn-delete-dish position-absolute top-0 end-0 m-2"
                    data-dish-id="{{ dish.id }}"
                    title="X√≥a m√≥n ƒÉn">
                        <i class="fas fa-xmark"></i>
                    </button>

                    <div class="product-card-img-wrapper">
                        <img src="{{ url_for('static', filename=dish.image) if dish.image else url_for('static', filename='images/default.jpg') }}" alt="{{ dish.name }}">
                    </div>
                    <div class="product-card-body">
                        <h5 class="product-card-title">{{ dish.name }}</h5>
                        <p class="product-card-desc">{{ dish.description }}</p>
                        <div class="product-card-footer">
                            <div class="product-card-price">
                                <span class="current-price">{{ '{:,.0f}'.format(dish.price) }} ƒë</span>
                            </div>
                            <button class="btn-add-to-cart"
                                    data-id="{{ dish.id }}"
                                    data-name="{{ dish.name }}"
                                    data-desc="{{ dish.description }}"
                                    data-price="{{ dish.price }}"
                                    data-image="{{ dish.image }}"
                                    data-group="{{ dish.dish_group_id }}"
                            >
                                   <i class="fas fa-edit"></i>
                            </button>

                        </div>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
        <button type="button" class="add-dish-btn"
        data-group-id="{{ group.id }}">‚ûï Th√™m m√≥n ƒÉn</button>
    </div>
    {% endfor %}
    <!-- THE MODAL CHO DISHGROUP -->
    <div id="modal_dishgroup" class="modal">
        <!-- L·ªõp ph·ªß m√†u ƒëen ph√≠a sau (class n√†y c√≥ th·ªÉ d√πng chung cho c√°c modal kh√°c) -->
        <div class="modal-overlay"></div>

        <!-- N·ªôi dung c·ªßa Modal (class n√†y c√≥ th·ªÉ d√πng chung) -->
        <div class="modal-content">
            <button class="close-modal" title="ƒê√≥ng">√ó</button>
            <h2>Th√™m Nh√≥m M√≥n ƒÇn M·ªõi</h2>

            <!-- Form ƒë·ªÉ g·ª≠i d·ªØ li·ªáu, v·ªõi ID c·ª• th·ªÉ -->
            <form id="form_add_dishgroup">
                <div class="form-group">
                    <label for="input_dishgroup_name">T√™n nh√≥m m√≥n</label>
                    <input type="text" id="input_dishgroup_name" name="name" required placeholder="V√≠ d·ª•: M√≥n Khai V·ªã">
                </div>


                <button type="submit" class="btn-submit">L∆∞u Nh√≥m M·ªõi</button>
            </form>
        </div>
    </div>
    <!-- N√∫t ƒë·ªÉ m·ªü Offcanvas -->

         <!--TH√äM M√ìN ƒÇN - MODAL -->
            <div id="modal_add_dish" class="modal">
    <!-- L·ªõp ph·ªß m√†u ƒëen ph√≠a sau (d√πng chung class 'modal-overlay') -->
    <div class="modal-overlay"></div>

    <!-- N·ªôi dung c·ªßa Modal (d√πng chung class 'modal-content') -->
    <div class="modal-content">
        <!-- N√∫t ƒë√≥ng (d√πng chung class 'close-modal') -->
        <button class="close-modal" title="ƒê√≥ng">√ó</button>


        <h2>Th√™m M√≥n ƒÇn M·ªõi</h2>

        <!-- Form ƒë·ªÉ g·ª≠i d·ªØ li·ªáu, v·ªõi ID c·ª• th·ªÉ l√† 'form_add_dish' -->
        <form id="form_add_dish" enctype="multipart/form-data">
            <!-- TR∆Ø·ªúNG ·∫®N: R·∫•t quan tr·ªçng ƒë·ªÉ bi·∫øt m√≥n ƒÉn n√†y thu·ªôc nh√≥m n√†o -->
            <input type="hidden" id="dish_group_id_input" name="dish_group_id">
            <input type="hidden" name="restaurant_id" value="1"> <!-- Gi·∫£ s·ª≠ ID nh√† h√†ng l√† 1 -->

            <div class="form-group">
                <label for="input_dish_name">T√™n m√≥n ƒÉn</label>
                <input type="text" id="input_dish_name" name="name" required placeholder="V√≠ d·ª•: C∆°m T·∫•m S∆∞·ªùn">
            </div>

            <div class="form-group">
                <label for="input_dish_description">M√¥ t·∫£ (kh√¥ng b·∫Øt bu·ªôc)</label>
                <input type="text" id="input_dish_description" name="description" placeholder="V√≠ d·ª•: S∆∞·ªùn n∆∞·ªõng m·∫≠t ong">
            </div>

            <div class="form-group">
                <label for="input_dish_price">Gi√°</label>
                <input type="number" id="input_dish_price" name="price" required placeholder="V√≠ d·ª•: 35000">
            </div>
            <div class="form-group">
    <label class="form-label fw-bold">Th√™m v√†o c√°c nh√≥m t√πy ch·ªçn</label>
    <div id="add-dish-options-container" class="mt-2">
        {% for group in dish_option_group %}
            <div class="form-check">
                <!-- `name` ph·∫£i l√† "option_group_ids" (s·ªë nhi·ªÅu) -->
                <input class="form-check-input" type="checkbox"
                       name="option_group_ids"
                       value="{{ group.id }}"
                       id="add-dish-option-{{ group.id }}">
                <label class="form-check-label" for="add-dish-option-{{ group.id }}">
                    {{ group.name }}
                </label>
            </div>
        {% endfor %}
    </div>
</div>
            <div class="form-group">
                <label for="input_dish_image">H√¨nh ·∫£nh</label>
                <input type="file" id="input_dish_image" name="image" accept="image/*">
            </div>

            <button type="submit" class="btn-submit">L∆∞u M√≥n ƒÇn</button>
        </form>
    </div>
</div>
<!--S·ª¨A M√ìN ƒÇN -->
    <div id="modal_edit_dish" class="modal">
    <div class="modal-overlay"></div>
    <div class="modal-content">
        <button class="close-modal">√ó</button>
        <h2>S·ª≠a M√≥n ƒÇn</h2>
        <form id="form_edit_dish" enctype="multipart/form-data">
            <input type="hidden" name="dish_id" id="edit_dish_id">
            <input type="hidden" name="restaurant_id" value="1">
            <input type="hidden" name="dish_group_id" id="edit_group_id">

            <div class="form-group">
                <label>T√™n m√≥n ƒÉn</label>
                <input type="text" name="name" id="edit_name" required>
            </div>

            <div class="form-group">
                <label>M√¥ t·∫£</label>
                <input type="text" name="description" id="edit_description">
            </div>

            <div class="form-group">
                <label>Gi√°</label>
                <input type="number" name="price" id="edit_price" required>
            </div>
             <div class="form-group">
    <label class="form-label fw-bold">C√°c nh√≥m t√πy ch·ªçn li√™n k·∫øt</label>
    <div id="edit-dish-options-container" class="mt-2">
        {% for group in dish_option_group %}
            <div class="form-check">
                <input class="form-check-input" type="checkbox"
                       name="option_group_ids"
                       value="{{ group.id }}"
                       id="edit-dish-option-{{ group.id }}">
                <!-- S·ª¨A L·∫†I `for` ·ªû ƒê√ÇY ƒë·ªÉ kh·ªõp v·ªõi id ·ªü tr√™n -->
                <label class="form-check-label" for="edit-dish-option-{{ group.id }}">
                    {{ group.name }}
                </label>
            </div>
        {% endfor %}
    </div>
</div>
            <div class="form-group">
                <label>H√¨nh ·∫£nh m·ªõi (t√πy ch·ªçn)</label>
                <input type="file" name="image" accept="image/*">
            </div>

            <button type="submit" class="btn-submit">L∆∞u thay ƒë·ªïi</button>
        </form>
    </div>
</div>
   <!-- ==== OFFCANVAS ƒê·ªÇ T·∫†O M·ªöI DISH OPTION GROUP ==== -->
<div class="offcanvas offcanvas-end" style="--bs-offcanvas-width: 500px;" tabindex="-1" id="dynamicFormOffcanvas" aria-labelledby="offcanvasLabel">
    <div class="offcanvas-header border-bottom">
        <h5 class="offcanvas-title" id="offcanvasLabel">T·∫°o Nh√≥m T√πy Ch·ªçn M·ªõi</h5>
        <button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Close"></button>
    </div>
    <div class="offcanvas-body">
        <form id="dynamicForm">
            <!-- T√™n nh√≥m -->
            <div class="mb-4">
                <label for="groupName" class="form-label fw-bold">T√™n nh√≥m t√πy ch·ªçn</label>
                <input type="text" class="form-control" id="groupName" placeholder="V√≠ d·ª•: Topping, Ch·ªçn Size...">
            </div>
            <div class="mb-3">
            <label for="maxSelection" class="form-label">L·ª±a ch·ªçn t·ªëi ƒëa</label>
            <input type="number" class="form-control" id="maxSelection" min="1" placeholder="B·ªè tr·ªëng n·∫øu kh√¥ng gi·ªõi h·∫°n">
        </div>

        <!-- 3. B·∫Øt bu·ªôc (TR∆Ø·ªúNG M·ªöI CHO `mandatory`) -->
        <div class="form-check form-switch p-0">
             <label class="form-check-label" for="isMandatory">B·∫Øt bu·ªôc</label>
            <input class="form-check-input" style="margin: auto" type="checkbox" role="switch" id="isMandatory">
        </div>
            <hr>

            <!-- C√°c l·ª±a ch·ªçn -->
            <h6 class="fw-bold mb-3">C√°c L·ª±a Ch·ªçn Trong Nh√≥m</h6>
            <div id="dynamicInputsContainer">
                <!-- JavaScript s·∫Ω ch√®n c√°c "Th·∫ª L·ª±a Ch·ªçn" v√†o ƒë√¢y -->
            </div>

            <!-- N√∫t th√™m th·∫ª m·ªõi -->
            <button type="button" class="btn w-100 mt-2" id="addInputButton">
                <i class="fas fa-plus"></i> Th√™m L·ª±a Ch·ªçn
            </button>
        </form>
    </div>
    <div class="offcanvas-footer p-3 border-top bg-light">
        <button type="submit" class="btn btn-success w-100 fw-bold" form="dynamicForm">
            L∆∞u
        </button>
    </div>
</div>
</div>
<!-- OFF-CANVAS "S·ª¨A" - ID M·ªöI, CLASS GI·ªêNG H·ªÜT OFF-CANVAS "T·∫†O" -->
<div class="offcanvas offcanvas-end" style="--bs-offcanvas-width: 500px;" tabindex="-1"
     id="editOptionGroupOffcanvas"
     aria-labelledby="editOffcanvasLabel">

    <div class="offcanvas-header border-bottom">
        <h5 class="offcanvas-title" id="editOffcanvasLabel">Ch·ªânh S·ª≠a Nh√≥m T√πy Ch·ªçn</h5>
        <button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Close"></button>
    </div>

    <div class="offcanvas-body">
        <form id="editOptionGroupForm">
            <!-- Input ·∫©n ƒë·ªÉ l∆∞u ID c·ªßa group ƒëang s·ª≠a -->
            <input type="hidden" id="editGroupId">

            <!-- C√°c tr∆∞·ªùng input -->
            <div class="mb-4">
                <label for="editGroupName" class="form-label fw-bold">T√™n nh√≥m t√πy ch·ªçn</label>
                <input type="text" class="form-control" id="editGroupName" required>
            </div>
            <div class="mb-3">
                <label for="editGroupMax" class="form-label">L·ª±a ch·ªçn t·ªëi ƒëa</label>
                <input type="number" class="form-control" id="editGroupMax" min="1" placeholder="B·ªè tr·ªëng n·∫øu kh√¥ng gi·ªõi h·∫°n">
            </div>
            <div class="form-check form-switch p-0">
                <label class="form-check-label" for="editGroupMandatory">B·∫Øt bu·ªôc</label>
                <input class="form-check-input" style="margin: auto" type="checkbox" role="switch" id="editGroupMandatory">
            </div>
            <hr>

            <h6 class="fw-bold mb-3">C√°c L·ª±a Ch·ªçn Trong Nh√≥m</h6>
            <div id="editOptionsContainer">
                <!-- JavaScript s·∫Ω ƒëi·ªÅn c√°c l·ª±a ch·ªçn v√†o ƒë√¢y -->
            </div>

            <!-- N√∫t th√™m l·ª±a ch·ªçn m·ªõi -->
            <button type="button" class="btn   w-100 mt-2" id="addAnotherOptionBtn">
                <i class="fas fa-plus"></i> Th√™m L·ª±a Ch·ªçn Kh√°c
            </button>
        </form>
    </div>

    <div class="offcanvas-footer p-3 border-top bg-light">
        <!-- N√∫t submit tr·ªè ƒë·∫øn form "S·ª≠a" b·∫±ng thu·ªôc t√≠nh `form` -->
        <button type="submit" class="btn btn-pink w-100 fw-bold" form="editOptionGroupForm">
            L∆∞u Thay ƒê·ªïi
        </button>
        <button type="button"   style=" margin-top: 10px" class="btn btn-outline-danger w-100 fw-bold " id="deleteGroupInsideFormBtn">
            X√≥a
        </button>

    </div>
</div>

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

<!-- Bootstrap Bundle JS (g·ªìm c·∫£ Popper) -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
{% endblock %}

{% block scripts %}
<script>
    document.addEventListener('DOMContentLoaded', function () {
        function reformatNumberInput(inputElement) {
            let value = inputElement.value;
            if (value.startsWith('0') && value.length > 1) {
                inputElement.value = Number(value);
            }
        }
        document.body.addEventListener('input', function(event) {
            if (event.target.matches('input[name="option_price"]') || event.target.matches('.edit-option-price')) {
                reformatNumberInput(event.target);
            }
        });

    });
    document.addEventListener('DOMContentLoaded', function () {
        // --- Ph·∫ßn 1: C√°c bi·∫øn v√† ph·∫ßn t·ª≠ c·∫ßn thi·∫øt ---
        const navList = document.getElementById('category-nav-list');
        const navLinks = document.querySelectorAll('#category-nav-list .category-nav-item');
        const navListe = document.getElementById('option-group-nav-list');
        const sections = document.querySelectorAll('.menu-section');
        const leftBtn = document.getElementById('scroll-left-btn');
        const rightBtn = document.getElementById('scroll-right-btn');
        const leftBtnn = document.getElementById('scroll-left-btnn');
        const rightBtnn = document.getElementById('scroll-right-btnn');

        // Chi·ªÅu cao c·ªßa header v√† thanh nav ƒë·ªÉ t√≠nh to√°n v·ªã tr√≠ cu·ªôn ch√≠nh x√°c
        const offsetHeight = 150;

        if (!navList) return; // Tho√°t n·∫øu kh√¥ng c√≥ thanh nav

        // --- Ph·∫ßn 2: X·ª≠ l√Ω c√°c n√∫t cu·ªôn tr√°i/ph·∫£i ---
        if (leftBtn && rightBtn) {
            const scrollAmount = 250;

            function updateButtonVisibility() {
                const maxScroll = navList.scrollWidth - navList.clientWidth;
                leftBtn.classList.toggle('d-none', navList.scrollLeft <= 0);
                rightBtn.classList.toggle('d-none', navList.scrollLeft >= maxScroll - 1);
            }

            leftBtn.addEventListener('click', () => navList.scrollBy({ left: -scrollAmount }));
            rightBtn.addEventListener('click', () => navList.scrollBy({ left: scrollAmount }));
            navList.addEventListener('scroll', updateButtonVisibility);
            setTimeout(updateButtonVisibility, 100);
        }
        if (leftBtnn && rightBtnn) {
            const scrollAmountt = 250;

            function updateButtonVisibilityy() {
                const maxScrolll = navListe.scrollWidth - navListe.clientWidth;
                leftBtnn.classList.toggle('d-none', navListe.scrollLeft <= 0);
                rightBtnn.classList.toggle('d-none', navListe.scrollLeft >= maxScrolll - 1);
            }

            leftBtnn.addEventListener('click', () => navListe.scrollBy({ left: -scrollAmountt }));
            rightBtnn.addEventListener('click', () => navListe.scrollBy({ left: scrollAmountt }));
            navListe.addEventListener('scroll', updateButtonVisibilityy);
            setTimeout(updateButtonVisibilityy, 100);
        }

        // --- Ph·∫ßn 3: X·ª≠ l√Ω highlight t·ª± ƒë·ªông KHI CU·ªòN trang ---
        function onWindowScroll() {
            let currentSectionId = '';

            // T√¨m xem section n√†o ƒëang ·ªü tr√™n c√πng c·ªßa m√†n h√¨nh
            sections.forEach(section => {
                const sectionTop = section.offsetTop - offsetHeight;
                if (window.pageYOffset >= sectionTop) {
                    currentSectionId = '#' + section.id;
                }
            });

            // Highlight link t∆∞∆°ng ·ª©ng trong thanh nav
            navLinks.forEach(link => {
                link.classList.remove('active'); // X√≥a active kh·ªèi t·∫•t c·∫£
                if (link.getAttribute('href') === currentSectionId) {
                    link.classList.add('active'); // Th√™m active cho link ƒë√∫ng
                    // T·ª± ƒë·ªông cu·ªôn thanh nav ƒë·ªÉ link active lu√¥n ƒë∆∞·ª£c nh√¨n th·∫•y
                    link.scrollIntoView({ behavior: 'smooth', block: 'nearest', inline: 'center' });
                }
            });
        }

        // G√°n s·ª± ki·ªán cu·ªôn cho to√†n b·ªô c·ª≠a s·ªï
        window.addEventListener('scroll', onWindowScroll);


        // --- Ph·∫ßn 4: X·ª≠ l√Ω cu·ªôn m∆∞·ª£t m√† KHI CLICK v√†o m·ªôt m·ª•c tr√™n nav ---
        navLinks.forEach(link => {
            link.addEventListener('click', function(event) {
                event.preventDefault(); // NgƒÉn h√†nh vi nh·∫£y trang m·∫∑c ƒë·ªãnh

                const targetId = this.getAttribute('href');
                const targetSection = document.querySelector(targetId);

                if (targetSection) {
                    const topPos = targetSection.offsetTop - (offsetHeight - 50); // B·ªõt ƒëi m·ªôt ch√∫t ƒë·ªÉ kh√¥ng b·ªã che
                    window.scrollTo({
                        top: topPos,
                        behavior: 'smooth'
                    });
                }
            });
        });

    });
document.addEventListener('DOMContentLoaded', function () {

        // --- 1. L·∫•y c√°c ph·∫ßn t·ª≠ c·ªßa thanh T√πy Ch·ªçn b·∫±ng ID ri√™ng c·ªßa n√≥ ---
        const optionsNavList = document.getElementById('option-group-nav-list');
        const optionsLeftBtn = document.getElementById('scroll-left-options-btn');
        const optionsRightBtn = document.getElementById('scroll-right-options-btn');

        // N·∫øu kh√¥ng t√¨m th·∫•y m·ªôt trong c√°c ph·∫ßn t·ª≠, tho√°t ƒë·ªÉ kh√¥ng g√¢y l·ªói
        if (!optionsNavList || !optionsLeftBtn || !optionsRightBtn) {
            return;
        }

        // --- 2. X·ª≠ l√Ω c√°c n√∫t cu·ªôn tr√°i/ph·∫£i ---
        const scrollAmount = 250;

        // H√†m n√†y c√≥ t√™n ri√™ng ƒë·ªÉ kh√¥ng xung ƒë·ªôt v·ªõi h√†m c·ªßa script c≈©
        function updateOptionsButtons() {
            const maxScroll = optionsNavList.scrollWidth - optionsNavList.clientWidth;

            // ·∫®n/hi·ªán c√°c n√∫t c·ªßa thanh T√πy Ch·ªçn
            optionsLeftBtn.classList.toggle('d-none', optionsNavList.scrollLeft <= 0);
            optionsRightBtn.classList.toggle('d-none', optionsNavList.scrollLeft >= maxScroll - 1);
        }

        // G√°n s·ª± ki·ªán click cho c√°c n√∫t c·ªßa thanh T√πy Ch·ªçn
        optionsLeftBtn.addEventListener('click', () => optionsNavList.scrollBy({ left: -scrollAmount, behavior: 'smooth' }));
        optionsRightBtn.addEventListener('click', () => optionsNavList.scrollBy({ left: scrollAmount, behavior: 'smooth' }));

        // G√°n s·ª± ki·ªán scroll cho thanh T√πy Ch·ªçn
        optionsNavList.addEventListener('scroll', updateOptionsButtons);

        // S·ª¨A L·ªñI HI·ªÇN TH·ªä:
        // D√πng ResizeObserver l√† c√°ch ƒë√°ng tin c·∫≠y nh·∫•t ƒë·ªÉ theo d√µi k√≠ch th∆∞·ªõc
        // v√† c·∫≠p nh·∫≠t n√∫t ƒë√∫ng th·ªùi ƒëi·ªÉm, thay v√¨ d√πng setTimeout.
        const observer = new ResizeObserver(updateOptionsButtons);
        observer.observe(optionsNavList);
    });
</script>
<script>

    const addInputButton = document.getElementById('addInputButton');
    const dynamicInputsContainer = document.getElementById('dynamicInputsContainer');
    const dynamicForm = document.getElementById('dynamicForm');

    // --- H√ÄM T·∫†O RA M·ªòT "TH·∫∫ L·ª∞A CH·ªåN" M·ªöI ---
    function createNewInputRow() {
        const cardWrapper = document.createElement('div');
        // G√°n class ƒë·ªÉ CSS c√≥ th·ªÉ √°p d·ª•ng style
        cardWrapper.classList.add('option-card');

        // N·ªôi dung HTML cho c·∫£ th·∫ª
        cardWrapper.innerHTML = `
            <!-- N√∫t x√≥a n·∫±m ·ªü g√≥c -->
            <button type="button" class="btn-delete-option" title="X√≥a l·ª±a ch·ªçn n√†y">
                <i class="fas fa-times"></i>
            </button>

            <!-- B·ªë c·ª•c 2 c·ªôt cho T√™n v√† Gi√° -->
            <div class="row g-3">
                <!-- C·ªôt 1: T√™n l·ª±a ch·ªçn -->
                <div class="col-md-7">
                    <label class="form-label">T√™n l·ª±a ch·ªçn</label>
                    <input type="text" class="form-control form-control-sm" name="option_name" required>
                </div>

                <!-- C·ªôt 2: Gi√° th√™m -->
                <div class="col-md-5">
                    <label class="form-label">Gi√° th√™m (ƒë)</label>
                    <input type="number" class="form-control form-control-sm" name="option_price" value="0" min="0" required>
                </div>
            </div>
        `;
        dynamicInputsContainer.appendChild(cardWrapper);
    }


    // --- G√ÅN S·ª∞ KI·ªÜN ---

    // 1. Click ƒë·ªÉ th√™m th·∫ª m·ªõi
    addInputButton.addEventListener('click', createNewInputRow);

    // 2. Click ƒë·ªÉ x√≥a th·∫ª
    dynamicInputsContainer.addEventListener('click', function(event) {
        const deleteButton = event.target.closest('.btn-delete-option');
        if (deleteButton) {
            // T√¨m ƒë·∫øn th·∫ª cha g·∫ßn nh·∫•t c√≥ class .option-card v√† x√≥a n√≥
            deleteButton.closest('.option-card').remove();
        }
    });

    // 3. Submit form ƒë·ªÉ thu th·∫≠p d·ªØ li·ªáu
    dynamicForm.addEventListener('submit', function(event) {
        event.preventDefault();

        const data = {
            name: document.getElementById('groupName').value.trim(),
            options: []
        };

        const allOptionCards = dynamicInputsContainer.querySelectorAll('.option-card');
        allOptionCards.forEach(card => {
            const name = card.querySelector('input[name="option_name"]').value.trim();
            const price = parseFloat(card.querySelector('input[name="option_price"]').value);
            if (name) {
                data.options.push({ name, price });
            }
        });

        if (!data.name || data.options.length === 0) {
            alert("Vui l√≤ng ƒëi·ªÅn ƒë·∫ßy ƒë·ªß t√™n nh√≥m v√† √≠t nh·∫•t m·ªôt l·ª±a ch·ªçn.");
            return;
        }

        console.log('D·ªØ li·ªáu d·∫°ng th·∫ª s·∫Ω ƒë∆∞·ª£c g·ª≠i ƒëi:');
        console.log(JSON.stringify(data, null, 2));
    });

    // T·ª± ƒë·ªông t·∫°o th·∫ª ƒë·∫ßu ti√™n
    createNewInputRow();
    //Th√™m DISH_OPTION_GROUP
 dynamicForm.addEventListener('submit', function(event) {
            event.preventDefault();

            // 1. Thu th·∫≠p d·ªØ li·ªáu t·ª´ form
            const data = {
                restaurant_id: "{{ restaurant.id }}", // L·∫•y ID nh√† h√†ng t·ª´ template
                name: document.getElementById('groupName').value.trim(),
                max: document.getElementById('maxSelection').value ? parseInt(document.getElementById('maxSelection').value) : null,
                mandatory: document.getElementById('isMandatory').checked,
                options: []
            };

            const allOptionCards = dynamicInputsContainer.querySelectorAll('.option-card');
            allOptionCards.forEach(card => {
                const name = card.querySelector('input[name="option_name"]').value.trim();
                const price = parseFloat(card.querySelector('input[name="option_price"]').value);
                if (name) {
                    data.options.push({ name, price });
                }
            });

            if (!data.name || data.options.length === 0) {
                alert("Vui l√≤ng ƒëi·ªÅn ƒë·∫ßy ƒë·ªß t√™n nh√≥m v√† √≠t nh·∫•t m·ªôt l·ª±a ch·ªçn.");
                return;
            }

            // 2. G·ª≠i d·ªØ li·ªáu ƒë·∫øn API b·∫±ng fetch
            fetch('/api/add_option_group', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(data)
            })
            .then(res => res.json())
            .then(result => {
                // 3. X·ª≠ l√Ω k·∫øt qu·∫£ tr·∫£ v·ªÅ t·ª´ server
                if (result.success) {
                    alert('‚úÖ ' + result.message);

                    // T·∫£i l·∫°i trang ƒë·ªÉ c·∫≠p nh·∫≠t danh s√°ch
                    location.reload();
                } else {
                    alert('‚ùå L·ªói: ' + result.message);
                }
            })
            .catch(error => {
                console.error('L·ªói khi g·ª≠i d·ªØ li·ªáu:', error);
                alert('‚ùå ƒê√£ x·∫£y ra l·ªói m·∫°ng. Vui l√≤ng th·ª≠ l·∫°i.');
            });
  });


</script>
<script>
    //S·ª¨A NH√ìM M√ìN
document.addEventListener('DOMContentLoaded', function () {

    const editOffcanvasEl = document.getElementById('editOptionGroupOffcanvas');

    // N·∫øu kh√¥ng c√≥ offcanvas "S·ª≠a" tr√™n trang th√¨ d·ª´ng l·∫°i
    if (!editOffcanvasEl) {
        return;
    }

    // --- 1. L·∫•y c√°c ph·∫ßn t·ª≠ DOM c·ªßa form "S·ª≠a" ---
    const editForm = document.getElementById('editOptionGroupForm');
    const editGroupIdInput = document.getElementById('editGroupId');
    const editGroupNameInput = document.getElementById('editGroupName');
    const editGroupMaxInput = document.getElementById('editGroupMax');
    const editGroupMandatoryInput = document.getElementById('editGroupMandatory');
    const editOptionsContainer = document.getElementById('editOptionsContainer');
    const addAnotherOptionBtn = document.getElementById('addAnotherOptionBtn');

    // --- 2. H√†m t√°i s·ª≠ d·ª•ng ƒë·ªÉ t·∫°o m·ªôt d√≤ng t√πy ch·ªçn ---
    const createEditOptionRow = (option = { name: '', price: 0 }) => {
        const card = document.createElement('div');
        card.className = 'option-card';
        card.innerHTML = `
            <button type="button" class="btn-delete-option" title="X√≥a"><i class="fas fa-times"></i></button>
            <div class="row g-3">
                <div class="col-md-7">
                    <label class="form-label">T√™n</label>
                    <input type="text" class="form-control form-control-sm edit-option-name" value="${option.name}" required>
                </div>
                <div class="col-md-5">
                    <label class="form-label">Gi√°</label>
                    <input type="number" class="form-control form-control-sm edit-option-price" value="${option.price}" min="0" required>
                </div>
            </div>`;
        card.querySelector('.btn-delete-option').addEventListener('click', () => card.remove());
        return card;
    };

    // --- 3. L·∫Øng nghe s·ª± ki·ªán khi offcanvas CHU·∫®N B·ªä M·ªû (Fetch Data) ---
    editOffcanvasEl.addEventListener('show.bs.offcanvas', async function (event) {
        // D·ªçn d·∫πp form v√† hi·ªÉn th·ªã tr·∫°ng th√°i t·∫£i
        editForm.reset();
        editOptionsContainer.innerHTML = '<p class="text-center"><i class="fas fa-spinner fa-spin"></i> ƒêang t·∫£i d·ªØ li·ªáu...</p>';

        const triggerLink = event.relatedTarget;
        const groupId = triggerLink.dataset.groupId;

        try {
            const response = await fetch(`/api/option-group/${groupId}`);
            if (!response.ok) {
                throw new Error(`L·ªói m√°y ch·ªß: ${response.statusText}`);
            }
            const data = await response.json();

            // ƒê·ªï d·ªØ li·ªáu v√†o form
            editGroupIdInput.value = data.id;
            editGroupNameInput.value = data.name;
            editGroupMaxInput.value = data.max;
            editGroupMandatoryInput.checked = data.mandatory;

            editOptionsContainer.innerHTML = '';
            if (data.options && data.options.length > 0) {
                data.options.forEach(opt => editOptionsContainer.appendChild(createEditOptionRow(opt)));
            } else {
                editOptionsContainer.appendChild(createEditOptionRow());
            }
        } catch (error) {
            console.error("L·ªói khi t·∫£i d·ªØ li·ªáu nh√≥m t√πy ch·ªçn:", error);
            editOptionsContainer.innerHTML = `<div class="alert alert-danger">Kh√¥ng th·ªÉ t·∫£i d·ªØ li·ªáu. Vui l√≤ng th·ª≠ l·∫°i.</div>`;
        }
    });

    // --- 4. S·ª± ki·ªán cho n√∫t "Th√™m L·ª±a Ch·ªçn Kh√°c" ---
    addAnotherOptionBtn.addEventListener('click', () => {
        editOptionsContainer.appendChild(createEditOptionRow());
    });

    // --- 5. L·∫Øng nghe s·ª± ki·ªán khi SUBMIT FORM (G·ª≠i d·ªØ li·ªáu ƒëi) ---
    editForm.addEventListener('submit', function(event) {
    // NgƒÉn tr√¨nh duy·ªát t·∫£i l·∫°i trang, ch√∫ng ta s·∫Ω x·ª≠ l√Ω b·∫±ng JavaScript
    event.preventDefault();

    // ----- A. THU TH·∫¨P D·ªÆ LI·ªÜU -----

    // Thu th·∫≠p t·∫•t c·∫£ c√°c l·ª±a ch·ªçn (options) t·ª´ c√°c th·∫ª ƒë√£ t·∫°o
    let optionsPayload = [];
    editOptionsContainer.querySelectorAll('.option-card').forEach(card => {
        const name = card.querySelector('.edit-option-name').value.trim();
        const price = parseFloat(card.querySelector('.edit-option-price').value) || 0;

        // Ch·ªâ th√™m v√†o danh s√°ch n·∫øu ng∆∞·ªùi d√πng ƒë√£ nh·∫≠p t√™n
        if (name) {
            optionsPayload.push({ name: name, price: price });
        }
    });

    // ƒê√≥ng g√≥i to√†n b·ªô d·ªØ li·ªáu (payload) ƒë·ªÉ g·ª≠i ƒë·∫øn server
    const payload = {
        id: parseInt(editGroupIdInput.value),
        name: editGroupNameInput.value.trim(),
        max: editGroupMaxInput.value ? parseInt(editGroupMaxInput.value) : null,
        mandatory: editGroupMandatoryInput.checked,
        options: optionsPayload
    };

    // ----- B. KI·ªÇM TRA D·ªÆ LI·ªÜU -----
    if (!payload.name || !payload.id) {
        alert("C√≥ l·ªói x·∫£y ra: T√™n nh√≥m ho·∫∑c ID kh√¥ng h·ª£p l·ªá.");
        return;
    }

    // ----- C. G·ª¨I D·ªÆ LI·ªÜU ƒê·∫æN API -----
    fetch('/api/option-group/update', { // API n√†y ch√∫ng ta s·∫Ω t·∫°o ·ªü backend
        method: 'POST', // Ph∆∞∆°ng th·ª©c l√† POST v√¨ ch√∫ng ta ƒëang g·ª≠i d·ªØ li·ªáu ƒë·ªÉ c·∫≠p nh·∫≠t
        headers: {
            'Content-Type': 'application/json', // B√°o cho server bi·∫øt ch√∫ng ta ƒëang g·ª≠i JSON
        },
        body: JSON.stringify(payload) // Chuy·ªÉn ƒë·ªëi t∆∞·ª£ng JavaScript th√†nh m·ªôt chu·ªói JSON
    })
    .then(res => res.json()) // Chuy·ªÉn ƒë·ªïi ph·∫£n h·ªìi t·ª´ server th√†nh JSON
    .then(result => {
        // ----- D. X·ª¨ L√ù K·∫æT QU·∫¢ -----
        if (result.success) {
            alert('‚úÖ ' + (result.message || 'C·∫≠p nh·∫≠t th√†nh c√¥ng!'));
            // T·∫£i l·∫°i trang l√† c√°ch ƒë∆°n gi·∫£n nh·∫•t ƒë·ªÉ th·∫•y thay ƒë·ªïi
            location.reload();
        } else {
            alert('‚ùå L·ªói: ' + (result.message || 'Kh√¥ng th·ªÉ c·∫≠p nh·∫≠t.'));
        }
    })
    .catch(error => {
        // B·∫Øt l·ªói n·∫øu c√≥ v·∫•n ƒë·ªÅ v·ªÅ m·∫°ng
        console.error("L·ªói khi g·ª≠i form s·ª≠a:", error);
        alert('‚ùå ƒê√£ x·∫£y ra l·ªói m·∫°ng. Vui l√≤ng th·ª≠ l·∫°i.');
    });
});

});
</script>
<script>
    const deleteBtnInsideForm = document.getElementById('deleteGroupInsideFormBtn');


// === S·ª∞ KI·ªÜN KHI CLICK V√ÄO N√öT "X√ìA" B√äN TRONG FORM ===
deleteBtnInsideForm.addEventListener('click', function() {

    // L·∫•y ID v√† t√™n c·ªßa nh√≥m ƒëang ƒë∆∞·ª£c s·ª≠a t·ª´ c√°c √¥ input
    const groupId = editGroupId.value;
    const groupName = editGroupName.value.trim();

    // N·∫øu kh√¥ng c√≥ ID, kh√¥ng l√†m g√¨ c·∫£ (ƒë·ªÉ ph√≤ng l·ªói)
    if (!groupId) {
        alert("Kh√¥ng th·ªÉ x√°c ƒë·ªãnh nh√≥m c·∫ßn x√≥a.");
        return;
    }

    // Hi·ªÉn th·ªã h·ªôp tho·∫°i x√°c nh·∫≠n
    if (confirm(`B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën x√≥a vƒ©nh vi·ªÖn nh√≥m "${groupName}" kh√¥ng?`)) {

        // G·ªçi API x√≥a (API n√†y b·∫°n ƒë√£ t·∫°o ·ªü b∆∞·ªõc tr∆∞·ªõc)
        fetch(`/api/option-group/delete/${groupId}`, {
            method: 'DELETE'
        })
        .then(res => res.json())
        .then(result => {
            if (result.success) {
                alert('‚úÖ ' + result.message);


                // T·∫£i l·∫°i trang ƒë·ªÉ c·∫≠p nh·∫≠t danh s√°ch
                location.reload();
            } else {
                alert('‚ùå L·ªói: ' + result.message);
            }
        })
        .catch(error => {
            console.error("L·ªói khi g·ª≠i y√™u c·∫ßu x√≥a t·ª´ trong form:", error);
            alert('‚ùå ƒê√£ x·∫£y ra l·ªói m·∫°ng.');
        });
    }
});
</script>

<script>
    //TH√äM NH√ìM M√ìN ƒÇN
document.addEventListener('DOMContentLoaded', function () {
    const modal = document.getElementById('modal_dishgroup');
    const openBtn = document.getElementById('btn_open_modal_dishgroup');
    const closeBtn = modal.querySelector('.close-modal');
    const overlay = modal.querySelector('.modal-overlay');
    const form = document.getElementById('form_add_dishgroup');

    if (!modal || !openBtn || !closeBtn || !overlay || !form) {
        console.warn('Kh√¥ng t√¨m th·∫•y ph·∫ßn t·ª≠ c·∫ßn thi·∫øt cho modal.');
        return;
    }

    // M·ªü modal
    openBtn.addEventListener('click', () => {
        modal.classList.add('show');
        modal_dishgroup.style.display = 'flex';
    });


    // ƒê√≥ng modal khi click X ho·∫∑c overlay
    const closeModal = () => modal.classList.remove('show');
    closeBtn.addEventListener('click', closeModal);
    overlay.addEventListener('click', closeModal);

    // G·ª≠i form th√™m nh√≥m m√≥n
    form.addEventListener('submit', function (event) {
        event.preventDefault();

        const formData = new FormData(form);
        const data = Object.fromEntries(formData.entries());
console.log('D·ªØ li·ªáu g·ª≠i l√™n server:', data);

        fetch('/add_dishgroup', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(data)
        })
        .then(res => res.json())
        .then(result => {
            if (result.success) {
                alert('‚úÖ Th√™m nh√≥m m√≥n th√†nh c√¥ng!');
                location.reload();
            } else {
                alert('‚ùå Th√™m th·∫•t b·∫°i: ' + result.message);
            }
        })
        .catch(err => {
            console.error(err);
            alert('‚ùå C√≥ l·ªói x·∫£y ra!');
        });
    });
});

</script>
<script>
    document.addEventListener('DOMContentLoaded', () => {
        document.querySelectorAll('.btn-delete-group').forEach(btn => {
            btn.addEventListener('click', () => {
                const groupId = btn.dataset.id;

                if (confirm('B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën xo√° nh√≥m m√≥n n√†y?')) {
                    fetch(`/delete_dishgroup/${groupId}`, {
                        method: 'DELETE'
                    })
                    .then(res => res.json())
                    .then(result => {
                        if (result.success) {
                            alert('‚úÖ ƒê√£ xo√° nh√≥m m√≥n!');
                            location.reload();
                        } else {
                            alert('‚ùå Xo√° th·∫•t b·∫°i: ' + result.message);
                        }
                    })
                    .catch(err => {
                        console.error(err);
                        alert('‚ùå L·ªói khi xo√° nh√≥m m√≥n!');
                    });
                }
            });
        });
    });
</script>
<script>
    //TH√äM M√ìN ƒÇN
  document.querySelectorAll('.add-dish-btn').forEach(button => {
  button.addEventListener('click', () => {
    const modal = document.getElementById('modal_add_dish');
    const groupId = button.getAttribute('data-group-id');
    document.getElementById('dish_group_id_input').value = groupId;
    const form = document.getElementById('form_add_dish');
    const closeBtn = modal.querySelector('.close-modal');
    const overlay = modal.querySelector('.modal-overlay');
    form.reset();

        // Sau khi reset, g√°n l·∫°i gi√° tr·ªã cho tr∆∞·ªùng ·∫©n
        document.getElementById('dish_group_id_input').value = groupId;
    const closeModal = () => modal.classList.remove('show');

    // üëá G·∫Øn ngay trong callback
    closeBtn.addEventListener('click', closeModal);
    overlay.addEventListener('click', closeModal);

    modal.classList.add('show');
   form.addEventListener('submit', function (e) {
  e.preventDefault(); // <-- Ch·∫∑n form submit m·∫∑c ƒë·ªãnh (GET)

  const formData = new FormData(form);

  fetch('/add_dish', {
    method: 'POST',
    body: formData
  })
  .then(res => res.json())
  .then(data => {
    if (data.success) {
      alert("‚úÖ Th√™m m√≥n ƒÉn th√†nh c√¥ng!");
      modal.classList.remove('show');
      form.reset();
      location.reload();
    } else {
      alert("‚ùå Th·∫•t b·∫°i: " + data.message);
    }
  })
  .catch(err => {
    console.error("L·ªói:", err);
    alert("‚ùå L·ªói g·ª≠i d·ªØ li·ªáu");
  });
});

  });
});
//S·ª¨A M√ìN ƒÇN
document.querySelectorAll('.btn-add-to-cart').forEach(btn => {
    btn.addEventListener('click', async () => {
        const dishId = btn.dataset.id;
        const modal = document.getElementById('modal_edit_dish');
        const form = document.getElementById('form_edit_dish');

        // Reset form ƒë·ªÉ x√≥a d·ªØ li·ªáu c≈© v√† b·ªè tick c√°c checkbox
        form.reset();
        modal.classList.add('show');

        const optionsContainer = document.getElementById('edit-dish-options-container');
        optionsContainer.innerHTML = '<p class="text-center"><i class="fas fa-spinner fa-spin"></i> ƒêang t·∫£i...</p>';

        try {
            // G·ªçi API ƒë·ªÉ l·∫•y d·ªØ li·ªáu chi ti·∫øt c·ªßa m√≥n ƒÉn
            const response = await fetch(`/api/dish-details/${dishId}`);
            if (!response.ok) throw new Error('Kh√¥ng th·ªÉ t·∫£i d·ªØ li·ªáu.');
            const data = await response.json();

            // ƒêi·ªÅn d·ªØ li·ªáu c∆° b·∫£n v√†o form
            form.querySelector('#edit_dish_id').value = data.id;
            form.querySelector('#edit_name').value = data.name;
            form.querySelector('#edit_description').value = data.description;
            form.querySelector('#edit_price').value = data.price;
            form.querySelector('#edit_group_id').value = data.dish_group_id;

            // Kh√¥i ph·ª•c l·∫°i HTML g·ªëc c·ªßa c√°c checkbox
            optionsContainer.innerHTML = `
                {% for group in dish_option_group %}
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox"
                               name="option_group_ids"
                               value="{{ group.id }}"
                               id="edit-dish-option-{{ group.id }}">
                        <label class="form-check-label" for="edit-dish-option-{{ group.id }}">
                            {{ group.name }}
                        </label>
                    </div>
                {% endfor %}
            `;

            // Tick s·∫µn v√†o c√°c checkbox ƒë√£ ƒë∆∞·ª£c li√™n k·∫øt
            if (data.linked_option_group_ids && data.linked_option_group_ids.length > 0) {
                const linkedIds = new Set(data.linked_option_group_ids.map(String));
                form.querySelectorAll('input[name="option_group_ids"]').forEach(checkbox => {
                    if (linkedIds.has(checkbox.value)) {
                        checkbox.checked = true;
                    }
                });
            }

        } catch (error) {
            console.error(error);
            alert(error.message);
            modal.classList.remove('show');
        }
    });
});

// 2. X·ª≠ l√Ω ƒë√≥ng modal
const editDishModal = document.getElementById('modal_edit_dish');
if (editDishModal) {
    editDishModal.querySelector('.close-modal').addEventListener('click', () => {
        editDishModal.classList.remove('show');
    });
    editDishModal.querySelector('.modal-overlay').addEventListener('click', () => {
        editDishModal.classList.remove('show');
    });
}

// 3. X·ª≠ l√Ω submit form s·ª≠a
const editDishForm = document.getElementById('form_edit_dish');
if (editDishForm) {
    editDishForm.addEventListener('submit', function (e) {
        e.preventDefault();
        const formData = new FormData(this);

        fetch('/update_dish', {
            method: 'POST',
            body: formData
        })
        .then(res => res.json())
        .then(data => {
            if (data.success) {
                alert("‚úÖ " + (data.message || "ƒê√£ c·∫≠p nh·∫≠t!"));
                location.reload();
            } else {
                alert("‚ùå S·ª≠a th·∫•t b·∫°i: " + (data.message || "L·ªói kh√¥ng x√°c ƒë·ªãnh."));
            }
        })
        .catch(err => {
            alert("‚ùå L·ªói h·ªá th·ªëng");
            console.error(err);
        });
    });
}
//X√ìA M√ìN ƒÇN
    document.querySelectorAll('.btn-delete-dish').forEach(btn => {
    btn.addEventListener('click', (e) => {
        e.preventDefault(); // NgƒÉn form ho·∫∑c n√∫t g√¢y reload kh√¥ng c·∫ßn thi·∫øt

        const dishId = btn.getAttribute('data-dish-id');
        const confirmDelete = confirm("üóëÔ∏è B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën x√≥a m√≥n ƒÉn n√†y kh√¥ng?");

        if (confirmDelete) {
            fetch('/delete_dish', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ dish_id: dishId })
            })
            .then(res => res.json())
            .then(data => {
                if (data.success) {
                    alert("‚úÖ M√≥n ƒÉn ƒë√£ ƒë∆∞·ª£c x√≥a th√†nh c√¥ng!");
                    location.reload(); // ho·∫∑c b·∫°n c√≥ th·ªÉ remove ph·∫ßn t·ª≠ kh·ªèi DOM
                } else {
                    alert("‚ùå Kh√¥ng th·ªÉ x√≥a: " + data.message);
                }
            })
            .catch(error => {
                console.error(error);
                alert("‚ùå ƒê√£ x·∫£y ra l·ªói khi x√≥a!");
            });
        }
    });
});

</script>
{% endblock %}