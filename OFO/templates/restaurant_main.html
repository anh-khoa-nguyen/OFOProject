<head>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/restaurant.css') }}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"/>
</head>
{% extends 'layout/base.html' %}


{% block content %}
<div class="container py-4">

    <div class="restaurant-info-block">
        <nav aria-label="breadcrumb">
            <ol class="breadcrumb">
                <li class="breadcrumb-item"><a href="#">Trang ch·ªß</a></li>
                <li class="breadcrumb-item"><a href="#">Nh√† h√†ng</a></li>
                <li class="breadcrumb-item active" aria-current="page">ToCoToCo - T√¥n ƒê·ª©c Th·∫Øng</li>
            </ol>
        </nav>

        <h1 class="restaurant-title mt-2">ToCoToCo - T√¥n ƒê·ª©c Th·∫Øng</h1>
        <p class="text-muted fs-5">Tr√† s·ªØa</p>

        <div class="restaurant-meta-group mt-3">
            <div class="restaurant-meta-item">
                <i class="bi bi-star-fill text-warning"></i>
                <span>4.4</span>
            </div>
            <div class="restaurant-meta-item">
                <i class="bi bi-clock"></i>
                <span>60 ph√∫t</span>
            </div>
            <div class="restaurant-meta-item">
                <i class="bi bi-dot"></i>
                <span>1.155,7 km</span>
            </div>
        </div>

        <div class="restaurant-meta-item mt-3 text-muted">
            <span>Gi·ªù m·ªü c·ª≠a</span>
            <strong class="text-dark ms-2">H√¥m nay 09:00-22:45</strong>
        </div>

        <div class="promo-section restaurant-meta-item mt-3">
            <i class="bi bi-tag-fill"></i>
            <span>T·∫≠n h∆∞·ªüng ∆∞u ƒë√£i</span>
            <a href="#" class="ms-2">Xem chi ti·∫øt</a>
        </div>
    </div>
    <div class="category-navbar-wrapper mt-4">
        <div class="category-navbar">

            <!-- N√∫t cu·ªôn tr√°i -->
            <button id="scroll-left-btn" class="scroll-btn left d-none">
                <i class="bi bi-chevron-left"></i>
            </button>

            <!-- Danh s√°ch c√°c danh m·ª•c -->
            <div id="category-nav-list" class="category-nav-list">
                <button id="btn_open_modal_dishgroup" class="btn-add-to-dish_group" title="Th√™m nh√≥m m√≥n">+</button>
                {% for group in dish_groups %}
                <a href="#section-{{ group.name | lower | replace(' ', '-') }}" class="category-nav-item">
                    {{ group.name }}
                </a>
                {% endfor %}
            </div>
            <!-- N√∫t cu·ªôn ph·∫£i -->
            <button id="scroll-right-btn" class="scroll-btn right">
                <i class="bi bi-chevron-right"></i>
            </button>

        </div>
    </div>
    <!-- ==== B·∫ÆT ƒê·∫¶U PH·∫¶N HI·ªÇN TH·ªä S·∫¢N PH·∫®M ==== -->
    {% for group in dish_groups %}
    <div id="section-{{ group.name | lower | replace(' ', '-') }}" class="menu-section">
        <h2 class="menu-section-title">{{ group.name }}
            <button class="btn-delete-group" title="Xo√° nh√≥m m√≥n" data-id="{{ group.id }}">
                <i class="fas fa-minus"></i>

            </button>
        </h2>
        <!-- N√∫t Xo√° -->


        <div class="row g-4">
            {% for dish in group.dishes.all() %}
            <div class="col-lg-4 col-md-6 d-flex">
                <div class="product-card w-100">
                    <button class="btn-delete-dish position-absolute top-0 end-0 m-2"
                    data-dish-id="{{ dish.id }}"
                    title="X√≥a m√≥n ƒÉn">
                        <i class="fas fa-xmark"></i>
                    </button>

                    <div class="product-card-img-wrapper">
                        <img src="{{ url_for('static', filename=dish.image) if dish.image else url_for('static', filename='images/default.jpg') }}"
     alt="{{ dish.name }}">
                    </div>
                    <div class="product-card-body">
                        <h5 class="product-card-title">{{ dish.name }}</h5>
                        <p class="product-card-desc">{{ dish.description }}</p>
                        <div class="product-card-footer">
                            <div class="product-card-price">
                                <span class="current-price">{{ '{:,.0f}'.format(dish.price) }} ƒë</span>
                            </div>
                            <button class="btn-add-to-cart"
                                    data-id="{{ dish.id }}"
                                    data-name="{{ dish.name }}"
                                    data-desc="{{ dish.description }}"
                                    data-price="{{ dish.price }}"
                                    data-image="{{ dish.image }}"
                                    data-group="{{ dish.dish_group_id }}">
                                   <i class="fas fa-edit"></i>
                            </button>

                        </div>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
        <button type="button" class="add-dish-btn"
        data-group-id="{{ group.id }}">‚ûï Th√™m m√≥n ƒÉn</button>
    </div>
    {% endfor %}
    <!-- THE MODAL CHO DISHGROUP -->
    <div id="modal_dishgroup" class="modal">
        <!-- L·ªõp ph·ªß m√†u ƒëen ph√≠a sau (class n√†y c√≥ th·ªÉ d√πng chung cho c√°c modal kh√°c) -->
        <div class="modal-overlay"></div>

        <!-- N·ªôi dung c·ªßa Modal (class n√†y c√≥ th·ªÉ d√πng chung) -->
        <div class="modal-content">
            <button class="close-modal" title="ƒê√≥ng">√ó</button>
            <h2>Th√™m Nh√≥m M√≥n ƒÇn M·ªõi</h2>

            <!-- Form ƒë·ªÉ g·ª≠i d·ªØ li·ªáu, v·ªõi ID c·ª• th·ªÉ -->
            <form id="form_add_dishgroup">
                <div class="form-group">
                    <label for="input_dishgroup_name">T√™n nh√≥m m√≥n</label>
                    <input type="text" id="input_dishgroup_name" name="name" required placeholder="V√≠ d·ª•: M√≥n Khai V·ªã">
                </div>


                <button type="submit" class="btn-submit">L∆∞u Nh√≥m M·ªõi</button>
            </form>
        </div>
    </div>
    <!-- N√∫t ƒë·ªÉ m·ªü Offcanvas -->
    <button class="btn btn-primary btn-lg" type="button" data-bs-toggle="offcanvas"
            data-bs-target="#productOptionsOffcanvas" aria-controls="productOptionsOffcanvas">
        M·ªü T√πy ch·ªçn s·∫£n ph·∫©m
    </button>
         <!--TH√äM M√ìN ƒÇN - MODAL -->
            <div id="modal_add_dish" class="modal">
    <!-- L·ªõp ph·ªß m√†u ƒëen ph√≠a sau (d√πng chung class 'modal-overlay') -->
    <div class="modal-overlay"></div>

    <!-- N·ªôi dung c·ªßa Modal (d√πng chung class 'modal-content') -->
    <div class="modal-content">
        <!-- N√∫t ƒë√≥ng (d√πng chung class 'close-modal') -->
        <button class="close-modal" title="ƒê√≥ng">√ó</button>


        <h2>Th√™m M√≥n ƒÇn M·ªõi</h2>

        <!-- Form ƒë·ªÉ g·ª≠i d·ªØ li·ªáu, v·ªõi ID c·ª• th·ªÉ l√† 'form_add_dish' -->
        <form id="form_add_dish" enctype="multipart/form-data">
            <!-- TR∆Ø·ªúNG ·∫®N: R·∫•t quan tr·ªçng ƒë·ªÉ bi·∫øt m√≥n ƒÉn n√†y thu·ªôc nh√≥m n√†o -->
            <input type="hidden" id="dish_group_id_input" name="dish_group_id">
            <input type="hidden" name="restaurant_id" value="1"> <!-- Gi·∫£ s·ª≠ ID nh√† h√†ng l√† 1 -->

            <div class="form-group">
                <label for="input_dish_name">T√™n m√≥n ƒÉn</label>
                <input type="text" id="input_dish_name" name="name" required placeholder="V√≠ d·ª•: C∆°m T·∫•m S∆∞·ªùn">
            </div>

            <div class="form-group">
                <label for="input_dish_description">M√¥ t·∫£ (kh√¥ng b·∫Øt bu·ªôc)</label>
                <input type="text" id="input_dish_description" name="description" placeholder="V√≠ d·ª•: S∆∞·ªùn n∆∞·ªõng m·∫≠t ong">
            </div>

            <div class="form-group">
                <label for="input_dish_price">Gi√°</label>
                <input type="number" id="input_dish_price" name="price" required placeholder="V√≠ d·ª•: 35000">
            </div>

            <div class="form-group">
                <label for="input_dish_image">H√¨nh ·∫£nh</label>
                <input type="file" id="input_dish_image" name="image" accept="image/*">
            </div>

            <button type="submit" class="btn-submit">L∆∞u M√≥n ƒÇn</button>
        </form>
    </div>
</div>
<!--S·ª¨A M√ìN ƒÇN -->
    <div id="modal_edit_dish" class="modal">
    <div class="modal-overlay"></div>
    <div class="modal-content">
        <button class="close-modal">√ó</button>
        <h2>S·ª≠a M√≥n ƒÇn</h2>
        <form id="form_edit_dish" enctype="multipart/form-data">
            <input type="hidden" name="dish_id" id="edit_dish_id">
            <input type="hidden" name="restaurant_id" value="1">
            <input type="hidden" name="dish_group_id" id="edit_group_id">

            <div class="form-group">
                <label>T√™n m√≥n ƒÉn</label>
                <input type="text" name="name" id="edit_name" required>
            </div>

            <div class="form-group">
                <label>M√¥ t·∫£</label>
                <input type="text" name="description" id="edit_description">
            </div>

            <div class="form-group">
                <label>Gi√°</label>
                <input type="number" name="price" id="edit_price" required>
            </div>

            <div class="form-group">
                <label>H√¨nh ·∫£nh m·ªõi (t√πy ch·ªçn)</label>
                <input type="file" name="image" accept="image/*">
            </div>

            <button type="submit" class="btn-submit">L∆∞u thay ƒë·ªïi</button>
        </form>
    </div>
</div>
    <!-- Offcanvas cho Product Options -->
    <div class="offcanvas offcanvas-end" tabindex="-1" id="productOptionsOffcanvas" aria-labelledby="offcanvasLabel">
        <div class="offcanvas-header">
            <h5 class="offcanvas-title" id="offcanvasLabel"></h5>
            <button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Close"></button>
        </div>
        <div class="offcanvas-body">
            <!-- N·ªòI DUNG C√ì TH·ªÇ CU·ªòN -->
            <div class="scrollable-content">
                <!-- Th√¥ng tin s·∫£n ph·∫©m ch√≠nh -->
                <div class="product-main-info d-flex align-items-start">
                    <img src="{{ url_for('static', filename='images/garan.png') }}" class="product-image me-3"
                         alt="Tr√† S·ªØa B∆°">
                    <div class="flex-grow-1">
                        <h5 class="fw-bold mb-1">Tr√† S·ªØa B∆°</h5>
                        <p class="small text-muted">S·ª± h√≤a quy·ªán gi·ªØa tr√† s·ªØa l√†i th∆°m thanh ƒë·∫≠m ƒë√† c√πng b∆° t∆∞∆°i ƒê√† L·∫°t
                            xay
                            nhuy·ªÖn v√† s√°nh m·ªãn. Th√¥ng tin d·ªã ·ª©ng: S·∫£n ph·∫©m c√≥ ch·ª©a s·ªØa</p>
                    </div>
                    <div class="text-end ms-2 flex-shrink-0">
                        <span class="fw-bold fs-5" id="basePriceText">27.000</span>
                    </div>
                </div>

                <!-- T√πy ch·ªçn Size -->
                <div class="options-section" id="size-options">
                    <div class="d-flex justify-content-between mb-3">
                        <h6 class="fw-bold mb-0">SIZE</h6>
                        <span class="badge bg-secondary-subtle text-secondary-emphasis rounded-pill">Pick 1</span>
                    </div>
                    <div class="d-flex justify-content-between align-items-center mb-2">
                        <div class="form-check">
                            <input class="form-check-input" type="radio" name="size" id="sizeM" data-base-price="27000"
                                   checked>
                            <label class="form-check-label w-100" for="sizeM">Tr√† S·ªØa B∆° M</label>
                        </div>
                    </div>
                    <div class="d-flex justify-content-between align-items-center">
                        <div class="form-check">
                            <input class="form-check-input" type="radio" name="size" id="sizeL" data-base-price="33000">
                            <label class="form-check-label w-100" for="sizeL">Tr√† S·ªØa B∆° L</label>
                        </div>
                        <span class="fw-normal">+6.000</span>
                    </div>
                </div>

                <!-- T√πy ch·ªçn Topping -->
                <div class="options-section" id="topping-options" data-max-selection="4">
                    <div class="d-flex justify-content-between mb-3">
                        <div>
                            <h6 class="fw-bold mb-0">1. Topping</h6>
                            <small class="text-muted">Optional, max 4</small>
                        </div>
                        <span class="badge bg-secondary-subtle text-secondary-emphasis rounded-pill">Optional</span>
                    </div>
                    <!-- C√°c topping -->
                    <div class="d-flex justify-content-between align-items-center mb-2">
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" value="7000" id="topping1">
                            <label class="form-check-label w-100" for="topping1">S·ª£i Pha L√™</label>
                        </div>
                        <span class="fw-normal">+7.000</span>
                    </div>
                    <div class="d-flex justify-content-between align-items-center mb-2">
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" value="7000" id="topping2">
                            <label class="form-check-label w-100" for="topping2">Tr√¢n Ch√¢u C·ªß NƒÉng</label>
                        </div>
                        <span class="fw-normal">+7.000</span>
                    </div>
                    <div class="d-flex justify-content-between align-items-center mb-2">
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" value="10000" id="topping3">
                            <label class="form-check-label w-100" for="topping3">Topping Cheese Ball</label>
                        </div>
                        <span class="fw-normal">+10.000</span>
                    </div>
                    <div class="d-flex justify-content-between align-items-center">
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" value="7000" id="topping4">
                            <label class="form-check-label w-100" for="topping4">ƒê·∫≠u ƒê·ªè</label>
                        </div>
                        <span class="fw-normal">+7.000</span>
                    </div>
                </div>
                <div class="options-section">
                    <div class="mb-2">
                        <label for="specialInstructions" class="form-label">
                            <strong class="me-2">Special instructions</strong>
                            <small class="text-muted">Optional</small>
                        </label>
                        <input type="text" class="form-control" id="specialInstructions"
                               placeholder="E.g. No onions please">
                    </div>
                </div>

            </div>

            <!-- FOOTER C·ªê ƒê·ªäNH -->
            <div class="offcanvas-footer d-flex align-items-center justify-content-between">
                <div class="quantity-selector d-flex align-items-center">
                    <button class="btn" id="decrease-qty">-</button>
                    <input type="text" id="quantity" value="1" readonly>
                    <button class="btn" id="increase-qty">+</button>
                </div>
                <button class="btn btn-pink flex-grow-1 ms-3 fw-bold" id="add-to-basket-btn" disabled>Add to Basket
                </button>
            </div>
        </div>
    </div>


</div>
{% endblock %}

{% block scripts %}
<script>
    document.addEventListener('DOMContentLoaded', function () {
        // --- Ph·∫ßn 1: C√°c bi·∫øn v√† ph·∫ßn t·ª≠ c·∫ßn thi·∫øt ---
        const navList = document.getElementById('category-nav-list');
        const navLinks = document.querySelectorAll('#category-nav-list .category-nav-item');
        const sections = document.querySelectorAll('.menu-section');
        const leftBtn = document.getElementById('scroll-left-btn');
        const rightBtn = document.getElementById('scroll-right-btn');

        // Chi·ªÅu cao c·ªßa header v√† thanh nav ƒë·ªÉ t√≠nh to√°n v·ªã tr√≠ cu·ªôn ch√≠nh x√°c
        const offsetHeight = 150;

        if (!navList) return; // Tho√°t n·∫øu kh√¥ng c√≥ thanh nav

        // --- Ph·∫ßn 2: X·ª≠ l√Ω c√°c n√∫t cu·ªôn tr√°i/ph·∫£i ---
        if (leftBtn && rightBtn) {
            const scrollAmount = 250;

            function updateButtonVisibility() {
                const maxScroll = navList.scrollWidth - navList.clientWidth;
                leftBtn.classList.toggle('d-none', navList.scrollLeft <= 0);
                rightBtn.classList.toggle('d-none', navList.scrollLeft >= maxScroll - 1);
            }

            leftBtn.addEventListener('click', () => navList.scrollBy({ left: -scrollAmount }));
            rightBtn.addEventListener('click', () => navList.scrollBy({ left: scrollAmount }));
            navList.addEventListener('scroll', updateButtonVisibility);
            setTimeout(updateButtonVisibility, 100);
        }

        // --- Ph·∫ßn 3: X·ª≠ l√Ω highlight t·ª± ƒë·ªông KHI CU·ªòN trang ---
        function onWindowScroll() {
            let currentSectionId = '';

            // T√¨m xem section n√†o ƒëang ·ªü tr√™n c√πng c·ªßa m√†n h√¨nh
            sections.forEach(section => {
                const sectionTop = section.offsetTop - offsetHeight;
                if (window.pageYOffset >= sectionTop) {
                    currentSectionId = '#' + section.id;
                }
            });

            // Highlight link t∆∞∆°ng ·ª©ng trong thanh nav
            navLinks.forEach(link => {
                link.classList.remove('active'); // X√≥a active kh·ªèi t·∫•t c·∫£
                if (link.getAttribute('href') === currentSectionId) {
                    link.classList.add('active'); // Th√™m active cho link ƒë√∫ng
                    // T·ª± ƒë·ªông cu·ªôn thanh nav ƒë·ªÉ link active lu√¥n ƒë∆∞·ª£c nh√¨n th·∫•y
                    link.scrollIntoView({ behavior: 'smooth', block: 'nearest', inline: 'center' });
                }
            });
        }

        // G√°n s·ª± ki·ªán cu·ªôn cho to√†n b·ªô c·ª≠a s·ªï
        window.addEventListener('scroll', onWindowScroll);


        // --- Ph·∫ßn 4: X·ª≠ l√Ω cu·ªôn m∆∞·ª£t m√† KHI CLICK v√†o m·ªôt m·ª•c tr√™n nav ---
        navLinks.forEach(link => {
            link.addEventListener('click', function(event) {
                event.preventDefault(); // NgƒÉn h√†nh vi nh·∫£y trang m·∫∑c ƒë·ªãnh

                const targetId = this.getAttribute('href');
                const targetSection = document.querySelector(targetId);

                if (targetSection) {
                    const topPos = targetSection.offsetTop - (offsetHeight - 50); // B·ªõt ƒëi m·ªôt ch√∫t ƒë·ªÉ kh√¥ng b·ªã che
                    window.scrollTo({
                        top: topPos,
                        behavior: 'smooth'
                    });
                }
            });
        });

    });
</script>
<script>
    document.addEventListener('DOMContentLoaded', function() {
        const offcanvasElement = document.getElementById('productOptionsOffcanvas');

        // L·∫•y c√°c element c·∫ßn thi·∫øt
        const quantityInput = document.getElementById('quantity');
        const decreaseBtn = document.getElementById('decrease-qty');
        const increaseBtn = document.getElementById('increase-qty');
        const addToBasketBtn = document.getElementById('add-to-basket-btn');

        const sizeOptions = document.querySelectorAll('input[name="size"]');
        const toppingOptionsContainer = document.getElementById('topping-options');
        const toppingOptions = toppingOptionsContainer.querySelectorAll('input[type="checkbox"]');
        const maxToppings = parseInt(toppingOptionsContainer.dataset.maxSelection);

        // H√†m ƒë·ªãnh d·∫°ng ti·ªÅn t·ªá
        function formatCurrency(value) {
            return new Intl.NumberFormat('vi-VN').format(value);
        }

        // H√†m ch√≠nh ƒë·ªÉ c·∫≠p nh·∫≠t t·ªïng gi√° ti·ªÅn
        function updateTotal() {
            // 1. L·∫•y gi√° c∆° b·∫£n t·ª´ size ƒë√£ ch·ªçn
            const selectedSize = document.querySelector('input[name="size"]:checked');
            let basePrice = parseFloat(selectedSize.dataset.basePrice);

            // 2. T√≠nh t·ªïng gi√° topping
            let toppingPrice = 0;
            let checkedToppingsCount = 0;
            toppingOptions.forEach(checkbox => {
                if (checkbox.checked) {
                    toppingPrice += parseFloat(checkbox.value);
                    checkedToppingsCount++;
                }
            });

            // 3. L·∫•y s·ªë l∆∞·ª£ng
            const quantity = parseInt(quantityInput.value);

            // 4. T√≠nh t·ªïng cu·ªëi c√πng
            const total = (basePrice + toppingPrice) * quantity;

            // 5. C·∫≠p nh·∫≠t n·ªôi dung n√∫t
            addToBasketBtn.textContent = `Add to Basket - ${formatCurrency(total)} ‚Ç´`;
            addToBasketBtn.disabled = false;

            // 6. X·ª≠ l√Ω gi·ªõi h·∫°n topping
             toppingOptions.forEach(checkbox => {
                if (!checkbox.checked && checkedToppingsCount >= maxToppings) {
                    checkbox.disabled = true; // V√¥ hi·ªáu h√≥a c√°c checkbox ch∆∞a ch·ªçn khi ƒë·∫°t gi·ªõi h·∫°n
                } else {
                    checkbox.disabled = false; // B·∫≠t l·∫°i n·∫øu ch∆∞a ƒë·∫°t gi·ªõi h·∫°n
                }
            });
        }

        // G√°n s·ª± ki·ªán cho c√°c n√∫t v√† input
        increaseBtn.addEventListener('click', () => {
            quantityInput.value = parseInt(quantityInput.value) + 1;
            updateTotal();
        });

        decreaseBtn.addEventListener('click', () => {
            let currentQty = parseInt(quantityInput.value);
            if (currentQty > 1) {
                quantityInput.value = currentQty - 1;
                updateTotal();
            }
        });

        sizeOptions.forEach(radio => radio.addEventListener('change', updateTotal));
        toppingOptions.forEach(checkbox => checkbox.addEventListener('change', updateTotal));

        // T√≠nh to√°n l·∫ßn ƒë·∫ßu khi offcanvas ƒë∆∞·ª£c hi·ªÉn th·ªã
        offcanvasElement.addEventListener('shown.bs.offcanvas', function () {
            updateTotal();
        });
    });
</script>
<script>
    //TH√äM NH√ìM M√ìN ƒÇN
document.addEventListener('DOMContentLoaded', function () {
    const modal = document.getElementById('modal_dishgroup');
    const openBtn = document.getElementById('btn_open_modal_dishgroup');
    const closeBtn = modal.querySelector('.close-modal');
    const overlay = modal.querySelector('.modal-overlay');
    const form = document.getElementById('form_add_dishgroup');

    if (!modal || !openBtn || !closeBtn || !overlay || !form) {
        console.warn('Kh√¥ng t√¨m th·∫•y ph·∫ßn t·ª≠ c·∫ßn thi·∫øt cho modal.');
        return;
    }

    // M·ªü modal
    openBtn.addEventListener('click', () => {
        modal.classList.add('show');
        modal_dishgroup.style.display = 'flex';
    });


    // ƒê√≥ng modal khi click X ho·∫∑c overlay
    const closeModal = () => modal.classList.remove('show');
    closeBtn.addEventListener('click', closeModal);
    overlay.addEventListener('click', closeModal);

    // G·ª≠i form th√™m nh√≥m m√≥n
    form.addEventListener('submit', function (event) {
        event.preventDefault();

        const formData = new FormData(form);
        const data = Object.fromEntries(formData.entries());
console.log('D·ªØ li·ªáu g·ª≠i l√™n server:', data);

        fetch('/add_dishgroup', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(data)
        })
        .then(res => res.json())
        .then(result => {
            if (result.success) {
                alert('‚úÖ Th√™m nh√≥m m√≥n th√†nh c√¥ng!');
                location.reload();
            } else {
                alert('‚ùå Th√™m th·∫•t b·∫°i: ' + result.message);
            }
        })
        .catch(err => {
            console.error(err);
            alert('‚ùå C√≥ l·ªói x·∫£y ra!');
        });
    });
});

</script>
<script>
    document.addEventListener('DOMContentLoaded', () => {
        document.querySelectorAll('.btn-delete-group').forEach(btn => {
            btn.addEventListener('click', () => {
                const groupId = btn.dataset.id;

                if (confirm('B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën xo√° nh√≥m m√≥n n√†y?')) {
                    fetch(`/delete_dishgroup/${groupId}`, {
                        method: 'DELETE'
                    })
                    .then(res => res.json())
                    .then(result => {
                        if (result.success) {
                            alert('‚úÖ ƒê√£ xo√° nh√≥m m√≥n!');
                            location.reload();
                        } else {
                            alert('‚ùå Xo√° th·∫•t b·∫°i: ' + result.message);
                        }
                    })
                    .catch(err => {
                        console.error(err);
                        alert('‚ùå L·ªói khi xo√° nh√≥m m√≥n!');
                    });
                }
            });
        });
    });
</script>
<script>
    //TH√äM M√ìN ƒÇN
  document.querySelectorAll('.add-dish-btn').forEach(button => {
  button.addEventListener('click', () => {
    const modal = document.getElementById('modal_add_dish');
    const groupId = button.getAttribute('data-group-id');
    document.getElementById('dish_group_id_input').value = groupId;
    const form = document.getElementById('form_add_dish');
    const closeBtn = modal.querySelector('.close-modal');
    const overlay = modal.querySelector('.modal-overlay');

    const closeModal = () => modal.classList.remove('show');

    // üëá G·∫Øn ngay trong callback
    closeBtn.addEventListener('click', closeModal);
    overlay.addEventListener('click', closeModal);

    modal.classList.add('show');
   form.addEventListener('submit', function (e) {
  e.preventDefault(); // <-- Ch·∫∑n form submit m·∫∑c ƒë·ªãnh (GET)

  const formData = new FormData(form);

  fetch('/add_dish', {
    method: 'POST',
    body: formData
  })
  .then(res => res.json())
  .then(data => {
    if (data.success) {
      alert("‚úÖ Th√™m m√≥n ƒÉn th√†nh c√¥ng!");
      modal.classList.remove('show');
      form.reset();
      location.reload();
    } else {
      alert("‚ùå Th·∫•t b·∫°i: " + data.message);
    }
  })
  .catch(err => {
    console.error("L·ªói:", err);
    alert("‚ùå L·ªói g·ª≠i d·ªØ li·ªáu");
  });
});

  });
});

//S·ª¨A M√ìN ƒÇN
    document.querySelectorAll('.btn-edit-dish').forEach(btn => {
    btn.addEventListener('click', () => {
        const modal = document.getElementById('modal_add_dish');
        modal.classList.add('show');

        // L·∫•y th√¥ng tin t·ª´ n√∫t
        document.getElementById('input_dish_name').value = btn.dataset.name;
        document.getElementById('input_dish_description').value = btn.dataset.desc;
        document.getElementById('input_dish_price').value = btn.dataset.price;
        document.getElementById('dish_group_id_input').value = btn.dataset.group;
        document.getElementById('restaurant_id_input').value = "1";

        // G√°n th√™m hidden field ƒë·ªÉ bi·∫øt ƒëang s·ª≠a m√≥n n√†o
        let idInput = document.getElementById('dish_id_input');
        if (!idInput) {
            idInput = document.createElement('input');
            idInput.type = 'hidden';
            idInput.name = 'dish_id';
            idInput.id = 'dish_id_input';
            document.getElementById('form_add_dish').appendChild(idInput);
        }
        idInput.value = btn.dataset.id;
    });
});
    //S·ª¨A M√ìN ƒÇN
    document.querySelectorAll('.btn-add-to-cart').forEach(btn => {
    btn.addEventListener('click', () => {
        const modal = document.getElementById('modal_edit_dish');
        modal.classList.add('show');

        document.getElementById('edit_dish_id').value = btn.dataset.id;
        document.getElementById('edit_name').value = btn.dataset.name;
        document.getElementById('edit_description').value = btn.dataset.desc;
        document.getElementById('edit_price').value = btn.dataset.price;
        document.getElementById('edit_group_id').value = btn.dataset.group;
    });
});

// ƒê√≥ng modal
document.querySelector('#modal_edit_dish .close-modal').addEventListener('click', () => {
    document.getElementById('modal_edit_dish').classList.remove('show');
});
document.querySelector('#modal_edit_dish .modal-overlay').addEventListener('click', () => {
    document.getElementById('modal_edit_dish').classList.remove('show');
});

// Submit s·ª≠a m√≥n
document.getElementById('form_edit_dish').addEventListener('submit', function (e) {
    e.preventDefault();
    const formData = new FormData(this);

    fetch('/update_dish', {
        method: 'POST',
        body: formData
    })
    .then(res => res.json())
    .then(data => {
        if (data.success) {
            alert("‚úÖ ƒê√£ c·∫≠p nh·∫≠t!");
            location.reload();
        } else {
            alert("‚ùå S·ª≠a th·∫•t b·∫°i: " + data.message);
        }
    })
    .catch(err => {
        alert("‚ùå L·ªói h·ªá th·ªëng");
        console.error(err);
    });
});
//X√ìA M√ìN ƒÇN
    document.querySelectorAll('.btn-delete-dish').forEach(btn => {
    btn.addEventListener('click', (e) => {
        e.preventDefault(); // NgƒÉn form ho·∫∑c n√∫t g√¢y reload kh√¥ng c·∫ßn thi·∫øt

        const dishId = btn.getAttribute('data-dish-id');
        const confirmDelete = confirm("üóëÔ∏è B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën x√≥a m√≥n ƒÉn n√†y kh√¥ng?");

        if (confirmDelete) {
            fetch('/delete_dish', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ dish_id: dishId })
            })
            .then(res => res.json())
            .then(data => {
                if (data.success) {
                    alert("‚úÖ M√≥n ƒÉn ƒë√£ ƒë∆∞·ª£c x√≥a th√†nh c√¥ng!");
                    location.reload(); // ho·∫∑c b·∫°n c√≥ th·ªÉ remove ph·∫ßn t·ª≠ kh·ªèi DOM
                } else {
                    alert("‚ùå Kh√¥ng th·ªÉ x√≥a: " + data.message);
                }
            })
            .catch(error => {
                console.error(error);
                alert("‚ùå ƒê√£ x·∫£y ra l·ªói khi x√≥a!");
            });
        }
    });
});

</script>
{% endblock %}