<header class="sticky-top bg-white shadow-sm">
    <div class="">
        <nav class="navbar navbar-expand-lg navbar-light px-5">
            <!-- Logo -->
            <a class="navbar-brand" href="{{ url_for('index') }}">
                <img src="{{ url_for('static', filename='images/logokymie1.png') }}" alt="GrabFood Logo"
                     style="height: 50px;">
            </a>

            <!-- SỬA LẠI LOGIC: Chỉ hiển thị thanh địa chỉ nếu KHÔNG PHẢI là các trang đặc biệt -->
            {% if request.endpoint not in ['login_view', 'register', 'preregister', 'resregister', 'reslogin', 'restaurant_detail', 'index'] %}
            <div class="address-display-header mx-3" style="width: 350px;">
                {% if delivery_address and delivery_address != '...' %}
                <div class="input-group">
                    <span class="input-group-text"><i class="bi bi-geo-alt-fill text-danger"></i></span>
                    <input type="text" class="form-control" value="{{ delivery_address }}" disabled>
                    <button class="btn btn-outline-secondary" type="button" data-bs-toggle="modal"
                        data-bs-target="#mapModal">
                        <i class="bi bi-map"></i>
                    </button>
                </div>
                {% else %}
                <div class="input-group" id="goong_search_container">
                    <span class="input-group-text"><i class="bi bi-geo-alt-fill text-danger"></i></span>
                    <div id="geocoder-container" style="flex-grow: 1;"></div>
                    <button class="btn btn-outline-secondary" type="button" data-bs-toggle="modal"
                            data-bs-target="#mapModal">
                        <i class="bi bi-map"></i>
                    </button>
                </div>
                {% endif %}
            </div>
            {% endif %}

            <!-- Spacer to push controls to the right -->
            <div class="ms-auto d-flex align-items-center">

                <!-- Cart Button -->
                {% if not (current_user.is_authenticated and (current_user.role.name == 'RESTAURANT' or current_user.role.name=='ADMIN')) %}
                <button type="button" class="btn btn-custom-light me-2 position-relative" data-bs-toggle="offcanvas" data-bs-target="#cartOffcanvas" aria-controls="cartOffcanvas">
                    <i class="bi bi-bag"></i>
                    <span id="cart-badge" class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger" style="display: none;">
                        0
                        <span class="visually-hidden">items in cart</span>
                    </span>
                </button>
                {% endif %}
                {% if current_user.is_authenticated %}
                <!-- User Dropdown Menu -->
                <div class="dropdown">
                    <!-- Nút bấm để mở dropdown -->
                    <a href="#" class="btn btn-custom-light me-2 dropdown-toggle d-flex align-items-center" id="userDropdown" data-bs-toggle="dropdown" aria-expanded="false">
                        <img src="{{ current_user.avatar }}" width="25" class="rounded-circle me-2">
                        Chào {{ current_user.name }}
                    </a>

                    <!-- Nội dung của dropdown -->
                    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="userDropdown">
                        {% if current_user.role.name == 'ADMIN' %}
                        <li><a class="dropdown-item" href="{{ url_for('admin.index') }}"><i class="bi bi-shield-lock me-2"></i>Trang quản trị</a></li>
                        <li><a class="dropdown-item" href="/logout"><i class="bi bi-box-arrow-right me-2"></i>Đăng xuất</a></li>

                        {% endif %}
                        {% if current_user.role.name == 'RESTAURANT' %}
                        <li><a class="dropdown-item" href="/restaurante/{{ session['restaurant_id'] }}"><i class="bi bi-person me-2"></i>Nhà hàng của tôi</a></li>
                        <li><a class="dropdown-item" href="/logout"><i class="bi bi-box-arrow-right me-2"></i>Đăng xuất</a></li>



                        {% endif %}
                         {% if current_user.role.name == 'USER' %}
                        <li><a class="dropdown-item" href="#"><i class="bi bi-person me-2"></i>Tài khoản của tôi</a></li>

                        <!-- MỤC MỚI: NHÀ HÀNG YÊU THÍCH -->
                        <li><a class="dropdown-item" href="{{ url_for('favorite_restaurants_page') }}"><i class="bi bi-heart me-2"></i>Nhà hàng yêu thích</a></li>

                        <li><a class="dropdown-item" href="#"><i class="bi bi-receipt me-2"></i>Lịch sử đơn hàng</a></li>
                        <li><hr class="dropdown-divider"></li>
                        <li><a class="dropdown-item" href="/logout"><i class="bi bi-box-arrow-right me-2"></i>Đăng xuất</a></li>


                        {% endif %}

                    </ul>
                </div>

                {% else %}
                <!-- Login/Register Button (giữ nguyên) -->
                <a href="{{ url_for('login_view') }}" class="btn btn-custom-light me-2">
                    Đăng nhập/Đăng ký
                </a>
                {% endif %}

                <!-- Language Dropdown -->


            </div>
        </nav>
    </div>
</header>